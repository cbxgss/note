+ 7rf口试，近五年，PPT讲解，5分钟
  + 概述
  + 内容展开（1-3个问题）
  + 尽量用图
  + 总结

# 1 网络体系结构

## 1.1 基本概念和常用网络命令

-   基本概念
    -   **MAC地址**: 6个字节，用于在**局域网内部**实现主机到主机的通信
    -   **IP地址**: 4个字节，**不同网络**间
    -   **端口号**: 0-65535，0-1023保留，**进程到进程**
-   常用网络命令
    -   `ifconfig`: 查看本机的ip地址
    -   `ifconfig /all`: 查看本机的mac地址
    -   `netstat -an`: 查看本机的网络连接情况
    -   `ping 目标主机ip`: 测试网络通信状态

## 1.2 网络发展历史

## 1.3 网络的层次结构

## 1.4 协议概述

-   网络协议: 通信计算机双方必须共同遵守的一组约定
-   **协议三要素**: 语法、语义、时序
-   **协议的最终体现**: 网络上传输的数据包的格式

## 1.5 层次网络模型

-   OSI模型

    -   物理层

    -   数据链路层

        ![image-20211013202757620](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013202757620.png)

    -   网络层

    -   传输层

    -   会话层: 负责协调表示层之间的对话

    -   表示层: 以某种形式为应用层提供与信息表示相关的服务

    -   应用层

-   TCP/IP模型

    -   TCP/IP物理网络层: 对应OSI模型的物理层和链路层
    -   网络(IP)层
    -   传输(TCP)层

# 2 网络协议

## 2.1 协议规范

-   **一个标准要进行如下规定**
    -   提供的服务访问点(SAP)和下一层请求的服务访问点
    -   提供的功能
    -   协议内容，包括数据包的格式和数据包每个域的含义(包括包头)
    -   数据包的时序，用于实现指定的功能
-   让一个标准广泛使用
    -   填写RFC(Request for Comment 请求评议申请表)
    -   变成RFC + num，eg: RFC 791

## 2.2 地址

-   不同的协议层需要几个不同的地址来识别
-   地址如何分配
    -   硬件地址: 硬件提供商分配
    -   IP地址: 可以动态分配，也可以静态分配
    -   应用程序地址(端口号): 与硬件地址相匹配，或比IP地址分配更缺少控制
    -   主机名称地址(域名): 通常与政治有关

## 2.3 头部

-   头部由两部分组成
    -   **固定数据包型** = 固定项 + 可选项 + 载荷项 + 尾部项
        -   固定项: 地址，载荷数据，控制数据，头部数据
        -   可选项: 扩充固定项数据，可选控制数据，可选载荷控制数据
        -   载荷项
        -   尾部项: 可选域，常用于出错控制
    -   **无限制数据包型**: 常出现在应用层，此时已经不是数据包了，由应用自由解析

### 网络漏洞分类

+ 网络安全威胁模型
  + 攻击者把数据打包到载荷中
+ 漏洞->试探
+ 基于头部的漏洞和攻击
  + SYN雪崩式攻击
+ 基于验证的漏洞和攻击
+ 基于流量的漏洞和攻击

# 3 互联网

## 3.1 概述

-   互联网: 一个通过网络协议将不同设备互联在一起的设备集合
-   用户视角: 互联网提供了让他把计算机插入，然后能和连接在互联网上的任何人进行交流的一个接入点
-   服务商视角: ISP
-   安全视角

## 3.2 寻址

-   **地址欺骗**: 采用虚假的源地址

-   IP地址

    ![image-20211013205851078](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013205851078.png)

-   主机名与IP地址的匹配: 大多数不用IP，而是用主机名和域名

    -   域名和IP地址的转换: DNS

    -   DNS系统

        ![image-20211013210811112](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013210811112.png)

## 3.3 客户-服务器模式

## 3.4 路由

# 4 网络漏洞的分类

## 4.1 网络安全威胁模型

-   漏洞、试探和攻击
    -   **漏洞**: 出现在设计、实现和配置中
    -   **试探**: 利用有漏洞的协议和应用进行攻击
    -   **攻击**: 有时试探代码就是攻击代码，攻击代码本身也有漏洞

## 4.2 分类

-   **基于头部的漏洞和攻击**
    -   协议头部与标准发生了冲突，eg: 在头部的某个域中用了无效值
    -   eg: 死亡之探测(ping)。某些操作系统不能处理IP头部的无效值，拆分和重组时溢出缓冲区
-   **基于协议的漏洞和攻击**
    -   所有数据包都有效，但是与协议的执行过程有冲突
    -   eg: SYN雪崩式攻击。攻击者连续发送连接请求，不给服务器回应，让服务器缓冲区满了
-   **基于验证的漏洞和攻击**
    -   **验证**: 一个层对另一个层的识别以执行它的功能
        -   用户到用户验证
        -   用户到主机验证: 用户名和密码
        -   主机到主机验证: 主机地址或应用程序地址
        -   主机到用户验证
-   **基于流量的漏洞和攻击**
    -   攻击者截取流量并窃取信息
    -   攻击者法广播包，造成网络瘫痪

# 5 物理网络层概述

## 5.1 概述

-   **物理网络层**
    
    -   传输控制协议/网际协议(TCP/IP) 堆栈的最低层，并用于提供到网络的连接
    -   对应于OSI模型中的**物理层**和**链路层**，提供数据包的发送和接收服务
    
    ![image-20211013215139597](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013215139597.png)

## 5.2 常见的攻击方法

-   **硬件地址欺骗**
    -   大多数的网络设备用**目标地址**过滤掉不是发给自己的的数据包
    -   发数据包的时候，这个设备的**硬件地址**就作为**源地址**，同时作为**过滤器**决定设备应该读取网络上的哪个数据包
    -   **攻击者**可以带有他想要的**任意源地址**
-   **网络嗅探**: 利用计算机的网络接口截获其它计算机的数据报文的一种手段(不过滤了)
    -   典型的骨干网物理上是被保护的，这就使得嗅探很困难
    -   一旦流量进入互联网服务提供商（ISP）就不担心嗅探了
    -   大多数嗅探发生在无线方式方法互联网的模式
-   **物理攻击**

## 5.3 有线网络协议

-   **以太网协议**

    ![image-20211013220256424](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013220256424.png)

    -   **载波侦听多路访问/冲突检测 CSDA/CD** :有限以太网使用的协议

    -   为了监听，早期的双绞线系统中使用了: **集线器**

        ![image-20211013220401754](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013220401754.png)

        -   半双工: 一台发送时，其他等

    -   **网络交换机**(改进后): 维护每一台设备的硬件地址表

        -   **自学习**

        -   **流量的隔离**

        -   **全双工**: 可以同时发送和接受

            ![image-20211013220720921](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013220720921.png)

        -   不容易嗅探

        -   为了让网络管理员可以监听网络所有流量

            -   支持生成**树端口(spanning port)**或**镜像端口(mirrored port)**的交换机
                -   所有数据包的副本都发到这个端口
                -   但慢
            -   使用带交换机的集线器
                -   但集线器慢
            -   网络捕捉器
                -   插入在流量经过的线路上，并做数据的电子副本
                -   对当进入和离开一个机构时对流量的监控很有用
                -   不能提供跨单位间的流量监控

    -   **数据包(帧)格式**

        ![image-20211013221242183](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013221242183.png)

        -   以太网控制器产生: 帧 = 目标地址 + 源地址 + 类型/长度 + 数据
        -   然后以太网控制器追加: 序号(preamble)，起始帧限制符(SFD)，帧序检查(FCS)
            -   接受时再剥离
            -   攻击者抽取到的帧，是已经被剥离的
        -   序号: 7字节
        -   SFD: 1字节，在进行同步时钟时，用于指示同步
        -   目标地址，源地址: 6字节
        -   类型/长度: 2字节
        -   数据: 限制在1500字节内，最小是46字节(用于冲突检测，短了就必须追加)
        -   FCS: 证实帧没被破坏

    -   三种MAC地址

        ![image-20211013222103766](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211013222103766.png)

    -   **地址欺骗**

        -   以太网控制器使用的硬件地址是存储在只读存储器中的
        -   在系统启动时由软件复制到控制器中
        -   以太网地址可以通过软件修改

-   漏洞和攻击
    -   **基于头部的攻击**
        -   **把源地址和目标地址设为一样**
            -   有的交换机处理这种情况有问题
            -   这种攻击需要借助网络上的一个设备来完成，所以没有实际的对策，仅靠设备自身的安全
        -   **产生<46B或>1500B的数据包**
        
    -   **基于协议的攻击**
        -   利用**设备是否与CSMA/CD协议有冲突**，引起网络瘫痪
        
    -   **基于验证的攻击**: 

        -   **ARP中毒攻击**

            ![image-20211016121046087](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016121046087.png)

            -   与嗅探浏览效果相同，只是是在交换机环境下实施的
            -   设备D1相信攻击者的硬件地址是路由器R1的
            -   路由器R1相信攻击者的硬件地址是设备D1的
            -   攻击者就能够得到D1和R1间的所有流量，然后复制

        -   发送不同源地址的数据包，试图填满交换机表，或让交换机相信是另一台设备发来的数据包 (有些交换机，当两个端口有相同源地址的时候，默认递交所有流量)

        -   将一个设备的源地址设置为与另一个设备地址相同

    -   **基于流量的攻击**
        
        -   **流量嗅探**，可以用以下方式减灾
            -   采用**交互式网络环境**，即一个端口上只有一台设备
            -   **虚拟局域网VLAN**: 将流量隔离在虚拟网络
            -   **加密方法**
        -   用大量流量造成网络崩溃(广播)

## 5.4 无线网络协议

-   无线以太网

    ![image-20211016151609840](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016151609840.png)

-   **最大的安全漏洞**是**网络嗅探**
    
-   **无线以太网协议**

    -   基于有线以太网协议

    -   和有线以太网协议的区别

        -   无线以太网协议不能检测冲突
        -   无线以太包需要发回一个应答数据包以响应已发送的数据包

    -   需要的技术

        -   每台设备都执行同样的协议
        -   **访问接入点AP**(access point) (无线路由器)
            -   产生无线网络，并管理对网络的访问
            -   提供对有线网络的访问

    -   一个设备成为无线网络中的一部分需要的步骤

        ![image-20211016155417004](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016155417004.png)

        -   发现设备能到达的AP (识别到访问接入点的**SSID(服务装置识别)** 或 通过事先知道的SSID)
            -   信号指示: 每个AP广播自己的SSID的过程
            -   探测: 无线设备发送探测包
            -   探测回应: AP对探测包回应，有SSID
        -   接入网络
            -   发送**联系请求包**给AP
            -   AP用**联系响应包**回应
        -   使用以太网协议在设备和AP之间发送流量

    -   使用**载波侦听多路访问/冲突避免协议 CSMA/CA**

    -   访问接入点配置

        -   第一种配置: 用AP来延伸以太网络，AP对有线网络是透明的
        -   第二种配置: AP作为路由器的一部分，产生两个独立的硬件地址域

    -   以太网的帧格式

        ![image-20211016160528679](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016160528679.png)

        -   帧控制: 2B，用于识别帧的类型等
        -   延展性/ID: 2B
        -   地址1: 6B，目标地址
        -   地址2: 6B，传输设备地址
        -   地址3、地址4: 6B，在AP作为延伸网络的一部分，且作为流量中继时使用
        -   序号控制: 2B，用于应答处理
        -   数据: 限制在2312B，没有最小数据长度限制
        -   FCS帧序检验 (坏了就扔，不重传)

-   漏洞和攻击

    -   **基于头部的攻击**

        -   无线以太网帧中的大多数域是由硬 件控制器来处理的，击会导致攻击设备不能正常通信
        -   攻 击设备可以在帧控制器中设置值，以混淆其他无线设备。导致设备与访问接入点的联系出现故障，而不能访问网络

    -   **基于协议的攻击**

        -   **探测/钓鱼wardriving**: 利用SSID广播确定AP的位置。当有人使用SSID连接AP，又没有被验证时
            -   减少探测的一个常用方法: 采用加密手段或网络访问控制器NAC
        -   对CSMA/CA协议发起攻击: 攻击者发送大量信号

    -   **基于验证的攻击**

        -   有两个方面的无线网络验证
            -   设备验证: 验证AP是否有效
            -   访问接入点配置验证: 验证设备
        -   **恶意访问接入点**: 用户安装了一台无线访问接入点，不告知接入单位
        -   **非法访问接入点**: 攻击者安装了一台访问接入点，并伪装成有效访问接入点。从而捕捉无线设备的所有流量
            -   问题
                -   需要给无线设备提供网络的访问
                -   非法访问接入点没有采取无线加密 或 攻击者知道真是访问接入点的加密密钥

    -   **基于流量的攻击**

        -   **无线流量嗅探**: 为了减少这种攻击，无线以太标准增加了加密机制

            -   **有线对等私钥WEP**: 访问接入点和无线设备之间有一个共享的密钥， 用于加密数据帧

                ![image-20211016164505240](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016164505240.png)

            -   **Wi-Fi访问保护协议 WPA**

                -   无线设备和访问接入点仍然共享一 个共同的密码，但这个密码用于验证，而不是加密
                -   **会话加密密钥**: 中断之前一直有效

                ![image-20211016164529301](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016164529301.png)

    -   雪崩式攻击

## 5.5 常用对策

一般用于减少嗅探和验证攻击

-   **虚拟局域网 VLAN**
    -   静态VLAN: 基于固定端口划分
    -   动态VLAN: 基于设备的硬件地址
-   **网络访问控制 NAC**
    -   基本想法: 验证网络上的每个设备，而不仅仅是用户

# 6 网络层协议

## 6.1 概述

-   **泪滴攻击(分片攻击) teardrop**: 发送有重叠数据包的分组，让接收方重组时堆栈溢出
-   **地址解析协议 ARP**: 接收方无条件相信网络来的ARP包
    -   利用ARP欺骗攻击
        -   使被攻击主机无法与其他主机进行通信
        -   实现中间人攻击: 数据监听、数据篡改、网页挂马
        -   防御措施
            -   使用静态地址绑定
            -   使用ARP防火墙: 主机发送ARP请求后，收到响应才刷新ARP缓存表
-   **因特网控制报文协议 ICMP**

## 6.2 IPv4协议

-   **基于头部的攻击**
    -   **端点字段**: 主要由端点使用，在传递过程中不检测(长度、标识、标志、偏移、协议、源IP地址)
        -   最出名的攻击: 死亡之Ping
    -   **传递字段**: 由各个路由器检测，并且在传递过程中可能被修改
-   **基于协议的攻击**
    -   IP和ICMP的协议攻击比较少
        -   引起数据包路由错误
        -   对路由表进行攻击，重点目标是作为互联网骨干的大型网络
        -   攻击IP数据包载荷，攻击目标是上层协议
    -   路由跟踪攻击: 使用IP和ICMP发现到设备的路由
    -   ICMP拒绝服务和流量重定向攻击
        -   攻击者沿着路径嗅探流量，发现IP数据包
        -   根据数据包的头部信息，产生ICMP错误消息
        -   ICMP错误消息引起服务拒绝，或将流量重定向到错误的地方
    -   ARP协议缓冲区中毒: 攻击者发现了一个ARP请求，并用无效的ARP应答回应
-   **基于验证的攻击**
    -   **IP地址欺骗**: 攻击者发送的包不一定是他的IP
        -   **泛洪攻击**: 攻击者用一个假IP向网络中发送一个ICMP回应请求数据包
            -   放大攻击: 多个请求，或之间把源地址设置为广播地址
            -   处理措施: 将路由器配置为不允许内部广播，或不允许某些ICMP协议从外部进入
    -   **IP会话欺骗**: 通过ARP中毒，让目标相信攻击者有受害者的IP
    -   **端口欺骗**: 和IP欺骗类似
-   **基于流量的攻击**
    -   **IP嗅探**
    -   **IP雪崩攻击**
        -   使用IP广播地址
        -   制造ARP广播雪崩

## 6.3 引导协议和动态主机配置协议

-   **基于头部的攻击**: 无
-   **基于协议的攻击**
    -   **虚假硬件地址攻击**: 用虚假的硬件地址发送多个查找数据包，小号动态池里的IP
    -   **伪装攻击**: 伪装成获得释放的一个客户端，向服务器发送一个DHCP释放数据包，造成多个客户端同IP
    -   **欺骗性DHCP服务器**
    -   **嗅探DHCP数据包**

## 6.4 常用的IP对策

-   **IP过滤**

    -   基于IP头中的值(IP地址、端口号、协议类型)阻止IP流量
    -   DNS端口过滤

-   **网络地址转换NAT**: 公网就无法访问了，如果向从公网访问服务器，有下面的方法

    -   **把服务器部署在公网**
    -   **隧道 tunnel**: 如果公网中的计算机连接到私有网络，将NAT配置为允许数据包进入
        -   一个公共的IP+port 和 一个私有IP+port 映射

-   **虚拟专用网VPN**: 有三类

    -   网络到网络
    -   客户端到客户端
    -   客户端到网络

-   **IP安全(IPSEC)**: 一种为IPv6设计的支持加密和验证的设计

    -   使用一个头部支持验证，另一个同步支持加密和验证

        ![image-20211016174222652](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016174222652.png)

    -   **验证头部**

        -   字段
            -   安全参数索引: 用来区分同一数据流中所有数据包
            -   序列号: 防止数据包重发
            -   验证数据: 加密哈希值
        -   不能防止网络嗅探，对IPv4，验证头部是载荷的一部分

    -   **封装安全载荷 ESP**

        ![image-20211016174456727](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211016174456727.png)

# 7 传输层协议

##  7.1 概述

##  7.2 传输控制协议TCP

-   **多路复用**: TCP层利用该层支持多个应用
-   **连接管理**: TCP是面向连接的协议
    -   连接建立
    -   连接维护
    -   连接终止
-   **基于头部的攻击**
    -   两类
        -   攻击者发送无效的头部信息，扰乱TCP层的运行
        -   探测攻击: 攻击者使用回应无效的头部信息，来探测OS类型
    -   攻击标志字段的两类
        -   创建一个没有明确规定的标志组合的数据包，看OS回应来判断OS
        -   在一个已经打开的连接中发送无效序列号，能够中断单个连接
-   **基于协议的攻击**
    -   攻击者在端点，并与攻击目标进行不正确的通信
        -   SYN雪崩: 攻击者一直发送SYN数据包而不发送ACK数据包
    -   攻击者能嗅探流量，并把数据包插入到TCP协议流
    -   会话劫持
-   **基于验证的攻击**
    -   TCP不支持验证，用IP层提供全部验证
    -   恶意用户还是可以在保留端口上运行程序
-   **基于流量的攻击**
    -   雪崩攻击
    -   服务质量QOS (quality of service)

## 7.3 用户数据包协议UDP

-   **基于头部和协议的攻击**
    -   头部简单，没有
    -   协议没有，也没有
-   **基于验证的攻击**
    -   同TCP
    -   一般，一个组织会过滤53端口的 DNS外 的所有UDP流量
-   **基于流量的攻击**
    -   雪崩不是问题，因为UDP的应用回应较慢

## 7.4 域名服务DNS

-   域名->IP，几乎所有互联网应用都用域名而不是IP
-   使用UDP，非验证服务
-   两种模式
    -   递归
    -   迭代: 都是自己搞
-   两种对DNS的攻击
    -   攻击实际的服务器，目的是让服务器掉线
    -   攻击DNS协议及验证的缺失
-   **基于头部的攻击**
    -   基本没，因为一旦头部无效，DNS客户端或服务器会拒绝
-   **基于协议的攻击**
    -   一个恶意软件使用DNS端口号与防火墙外的另一个恶意软件进行通信
-   **基于验证的攻击**
    -   DNS系统中唯一的验证是服务器的IP地址，攻击者在DNS服务器插入恶意条目 或 发给客户端回应
    -   插入恶意条目的方法
        -   获取对服务器的访问，直接改数据
        -   **DNS缓存区中毒**: 攻击者向已发送查询请求给其他服务器的某个服务器发送恶意回应信息
    -   **欺骗应答**: 发给客户端欺骗应答，需要攻击者能看到DNS服务器和客户端的流量
-   **基于流量的攻击**
    -   雪崩(比较难)

## 7.5 常用对策

-   **传输层安全TLS**(Transport Layer Security) 或 **安全套接层SSL**(Secure Sockets Layer)

    -   作为一个单独的层，位于应用层和传输层中间
    -   消除 攻击者 伪装成另一个设备时的嗅探攻击 和 针对主机的验证攻击

    ![image-20211017113350913](%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8.assets/image-20211017113350913.png)

    -   阶段
        -   客户端和服务器同意使用加密和验证方法
        -   服务器提供证书，并选择地和客户端要证书
        -   交换密钥
        -   发送加密数据

